Three targeted fixes to `client/src/pages/trip-view.tsx` only. No schema changes, no server changes.

---

## Fix 1 — Flight journey primary label shows full route, not just first leg

**Problem:** When a connecting flight has variants, `VariantCards` receives `primaryLeg` (legs[0]) as its `segment`. `buildPrimaryLabel` reads that leg's departure and arrival — so a EWR→DFW→LAX journey shows "EWR → DFW" instead of "EWR → LAX".

**Fix:** In `JourneyViewCard`, pass additional journey context to `VariantCards` so it can build a correct label. Add an optional `journeyLegs` prop to `VariantCards`:

```tsx
function VariantCards({
  segment,
  variants,
  selectedVariantId,
  onSelect,
  locked,
  journeyLegs,  // ADD THIS
}: {
  segment: TripSegment;
  variants: any[];
  selectedVariantId?: string;
  onSelect: (segmentId: string, variantId: string) => void;
  locked?: boolean;
  journeyLegs?: TripSegment[];  // ADD THIS
}) {
```

Then update the primary card label builder inside `VariantCards`. Find the `if (segment.type === "flight" || segment.type === "charter_flight")` block that builds the primary card title and replace it with:

```tsx
if (segment.type === "flight" || segment.type === "charter_flight") {
  const meta = (segment.metadata || {}) as Record<string, any>;
  const fn = meta.flightNumber || "";
  
  // For journeys: use first leg origin → last leg destination
  if (journeyLegs && journeyLegs.length > 1) {
    const firstMeta = (journeyLegs[0].metadata || {}) as Record<string, any>;
    const lastMeta = (journeyLegs[journeyLegs.length - 1].metadata || {}) as Record<string, any>;
    const dep = firstMeta.departure?.iata || firstMeta.departureAirport || "";
    const arr = lastMeta.arrival?.iata || lastMeta.arrivalAirport || "";
    const airline = firstMeta.airline || "";
    const cabin = bookingClassLabels[meta.bookingClass] || "";
    const qty = meta.quantity || 1;
    const stops = journeyLegs.length - 1;
    
    const routePart = dep && arr ? `${dep} → ${arr}` : (airline || "Flight");
    const stopsPart = stops === 1 ? "1 stop" : `${stops} stops`;
    const extras: string[] = [stopsPart];
    if (cabin) extras.push(cabin);
    if (qty > 1) extras.push(`${qty} passengers`);
    
    return `${routePart} (${extras.join(", ")})`;
  }
  
  // Single-leg flight: existing logic
  const dep = meta.departure?.iata || meta.departureAirport || "";
  const arr = meta.arrival?.iata || meta.arrivalAirport || "";
  const cabin = bookingClassLabels[meta.bookingClass] || "";
  const qty = meta.quantity || 1;
  const parts: string[] = [];
  if (fn) parts.push(fn);
  if (dep && arr) parts.push(`${dep} → ${arr}`);
  const extras: string[] = [];
  if (cabin) extras.push(cabin);
  if (qty > 1) extras.push(`${qty} passengers`);
  return parts.length > 0
    ? `${parts.join(" ")}${extras.length > 0 ? ` (${extras.join(", ")})` : ""}`
    : primaryLabel;
}
```

Update the call site in `JourneyViewCard` to pass `journeyLegs`:

```tsx
<VariantCards
  segment={primaryLeg}
  variants={variants}
  selectedVariantId={localSelections?.[primaryLeg.id]}
  onSelect={onSelectVariant}
  locked={lockedSegments?.has(primaryLeg.id)}
  journeyLegs={legs}  // ADD THIS
/>
```

Also update `buildPrimaryLabel` (used in the submit review sheet) to accept optional `journeyLegs` for the same reason:

```typescript
function buildPrimaryLabel(segment: TripSegment, journeyLegs?: TripSegment[]): string {
  const meta = (segment.metadata || {}) as Record<string, any>;
  if (segment.type === "flight" || segment.type === "charter_flight") {
    if (journeyLegs && journeyLegs.length > 1) {
      const firstMeta = (journeyLegs[0].metadata || {}) as Record<string, any>;
      const lastMeta = (journeyLegs[journeyLegs.length - 1].metadata || {}) as Record<string, any>;
      const dep = firstMeta.departure?.iata || firstMeta.departureAirport || "";
      const arr = lastMeta.arrival?.iata || lastMeta.arrivalAirport || "";
      const airline = firstMeta.airline || "";
      return dep && arr ? `${dep} → ${arr}` : (airline || "Flight");
    }
    const dep = meta.departure?.iata || meta.departureAirport || "";
    const arr = meta.arrival?.iata || meta.arrivalAirport || "";
    const flight = meta.flightNumber || "";
    if (dep && arr && flight) return `${flight}: ${dep} → ${arr}`;
    if (dep && arr) return `${dep} → ${arr}`;
    return segment.title || "Primary flight";
  }
  if (segment.type === "hotel") {
    return meta.hotelName || meta.roomType || segment.title || "Primary room";
  }
  return segment.title || "Primary option";
}
```

---

## Fix 2 — Variant cards always show quantity and per-unit breakdown

**Problem:** The passenger count only shows on the primary card when `primaryQty > 1`. Variant cards show `vPpu × vQty` only when both are set. If an advisor enters a total cost without filling in `pricePerUnit`, the breakdown never shows — even when `quantity > 1`.

**Fix:** In the variant card rendering loop inside `VariantCards`, change the condition for showing the quantity/price line. Currently:

```tsx
{vPpu != null && vPpu > 0 && vQty > 1 && (
```

Change to show quantity whenever `vQty > 1`, whether or not `pricePerUnit` is set:

```tsx
{vQty > 1 && (
  <span className="text-[11px] text-muted-foreground">
    {vPpu != null && vPpu > 0
      ? `${formatViewCurrency(vPpu, v.currency || "USD")} × ${vQty} ${segment.type === "flight" || segment.type === "charter_flight" ? "passengers" : "rooms"}`
      : `${vQty} ${segment.type === "flight" || segment.type === "charter_flight" ? "passengers" : "rooms"}`
    }
  </span>
)}
```

Apply the same logic to the **primary card**. Currently:

```tsx
{primaryPpu != null && primaryPpu > 0 && primaryQty > 1 && (
```

Change to:

```tsx
{primaryQty > 1 && (
  <span className="text-[11px] text-muted-foreground">
    {primaryPpu != null && primaryPpu > 0
      ? `${formatViewCurrency(primaryPpu, segment.currency || "USD")} × ${primaryQty} ${segment.type === "flight" || segment.type === "charter_flight" ? "passengers" : "rooms"}`
      : `${primaryQty} ${segment.type === "flight" || segment.type === "charter_flight" ? "passengers" : "rooms"}`
    }
  </span>
)}
```

---

## Fix 3 — Replace two stacked floating CTAs with clean top/bottom anchored layout

**Problem:** There are two `fixed bottom-*` floating pills stacked on top of each other — the options submission bar at `bottom-6` and the approval bar at `bottom-20`. They overlap the itinerary content as the user scrolls, block text, and are presented in reverse logical order (approval above submission). The UX is confusing and visually messy.

**Solution:** Remove both floating/sticky CTAs entirely. Replace with:
- A **fixed top bar** (shown only on the client token link) that appears after the user scrolls past the hero, containing the version selector and an "Approve" button side by side — this replaces the current floating action bar's content
- An **inline bottom section** anchored to the bottom of the page content, below the advisor footer, with both actions presented sequentially in logical order: submit options first, then approve itinerary

### Step A — Remove the two floating bottom CTAs

Delete the two `{(() => { ... })()}` blocks that render:
- The `data-testid="variant-submit-bar"` `fixed bottom-6` motion div and its Sheet
- The `data-testid="version-approve-bar"` `fixed bottom-20` motion div and its Sheet

Keep the Sheet components themselves (`submitSheetOpen` sheet and `approveSheetOpen` sheet) — just move them to render unconditionally at the bottom of the component, not inside those floating wrappers.

### Step B — Update the existing floating top bar

The existing `showFloatingBar` top bar (the one that appears after scrolling, `fixed top-4`) already shows the version selector, PDF, and calendar buttons. When `token` is set, also add a compact "Approve" button to it (only if not yet approved):

```tsx
{token && !isAlreadyApproved && (
  <>
    <Separator orientation="vertical" className="h-5" />
    <Button
      size="sm"
      variant="ghost"
      className="h-7 px-2 text-xs text-primary"
      onClick={() => setApproveSheetOpen(true)}
      data-testid="button-floating-approve"
    >
      <CheckCircle className="w-3 h-3 mr-1" /> Approve
    </Button>
  </>
)}
{token && isAlreadyApproved && (
  <>
    <Separator orientation="vertical" className="h-5" />
    <span className="text-xs text-emerald-600 dark:text-emerald-400 flex items-center gap-1">
      <CheckCircle className="w-3 h-3" /> Approved
    </span>
  </>
)}
```

Where `isAlreadyApproved` is `!!(trip.approvedVersionId || approvalSuccess)`. Derive this at the top of the component render alongside the other derived state.

### Step C — Add inline bottom action section

Directly after the `</footer>` closing tag and before the `</div>` that closes the main content column, add an inline bottom action section that's only shown when `token` is set:

```tsx
{token && (() => {
  const allSegments = activeVersion?.segments || [];
  const variantSegments = allSegments.filter(s => s.hasVariants);
  const totalVariantSegments = variantSegments.length;
  const selectedCount = variantSegments.filter(s => localSelections[s.id]).length;
  const allLocked = variantSegments.length > 0 && variantSegments.every(s => lockedSegments.has(s.id));
  const isAlreadyApproved = !!(trip.approvedVersionId || approvalSuccess);

  return (
    <div className="border-t border-border/40 py-10 space-y-6" data-testid="bottom-action-section">

      {/* Step 1: Submit options — only shown if there are options to select */}
      {totalVariantSegments > 0 && (
        <div className="text-center space-y-3">
          {allLocked || submitSuccess ? (
            <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-50 border border-emerald-200 text-emerald-700 dark:bg-emerald-950/30 dark:border-emerald-800 dark:text-emerald-400">
              <CheckCircle className="w-4 h-4" />
              <span className="text-sm font-medium">Options submitted</span>
              {trip.selectionsSubmittedAt && (
                <span className="text-xs opacity-70">· {format(new Date(trip.selectionsSubmittedAt), "d MMM")}</span>
              )}
            </div>
          ) : (
            <>
              <p className="text-sm font-medium">
                {selectedCount > 0
                  ? `${selectedCount} of ${totalVariantSegments} options selected`
                  : "You have options to review above"
                }
              </p>
              <Button
                variant="outline"
                className="rounded-full px-8"
                disabled={selectedCount === 0}
                onClick={() => { setSubmitSuccess(false); setSubmitSheetOpen(true); }}
                data-testid="button-review-submit-bottom"
              >
                <Send className="w-3.5 h-3.5 mr-2" />
                Review & Submit Options
              </Button>
            </>
          )}
        </div>
      )}

      {/* Step 2: Approve itinerary */}
      <div className="text-center space-y-3">
        {isAlreadyApproved ? (
          <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-50 border border-emerald-200 text-emerald-700 dark:bg-emerald-950/30 dark:border-emerald-800 dark:text-emerald-400">
            <CheckCircle className="w-4 h-4" />
            <span className="text-sm font-medium">
              {activeVersion?.name} approved
            </span>
            {trip.approvedAt && (
              <span className="text-xs opacity-70">· {format(new Date(trip.approvedAt), "d MMM")}</span>
            )}
          </div>
        ) : (
          <>
            <p className="text-sm font-medium">Ready to proceed with {activeVersion?.name}?</p>
            <p className="text-xs text-muted-foreground">
              This confirms you'd like to move forward. Your advisor will be notified.
            </p>
            <Button
              className="rounded-full px-8"
              onClick={() => { setApprovalSuccess(false); setApproveSheetOpen(true); }}
              data-testid="button-approve-bottom"
            >
              <CheckCircle className="w-4 h-4 mr-2" />
              Approve {activeVersion?.name}
            </Button>
          </>
        )}
      </div>

    </div>
  );
})()}
```

### Step D — Move the Sheets out of the deleted floating wrappers

The two `<Sheet>` components (submit selections sheet and approve sheet) should now render unconditionally as siblings near the bottom of the component, outside of any `{(() => ...)()}` wrapper. They were previously inside the floating bar blocks — just move them to the end of the JSX return, before the final closing tag. Their open/close state (`submitSheetOpen`, `approveSheetOpen`) remains unchanged.